# ===========================================
# API SETTINGS
# ===========================================

API_PORT=7555
DEBUG=false

# OCR Settings
OCR_LANGUAGES=rus+eng

# Processing Settings
PROCESSING_TIMEOUT_SECONDS=300

# ===========================================
# PERFORMANCE SETTINGS
# ===========================================

# Number of CPU cores on the server (used to auto-calculate WORKERS)
# For Docker: number of available cores in container
# For bare metal: number of physical server cores
CPU_CORES=4

# Number of uvicorn worker processes
# For development: 1
# For production recommended: 2 * CPU_CORES + 1 (auto-calculated in prod)
WORKERS=1

# ===========================================
# FILE PROCESSING SETTINGS
# ===========================================

# Maximum file size (20MB in bytes)
MAX_FILE_SIZE=20971520

# Archive settings
# Maximum archive size (20MB)
MAX_ARCHIVE_SIZE=20971520
# Maximum extracted content size (100MB)
MAX_EXTRACTED_SIZE=104857600
# Maximum archive nesting depth
MAX_ARCHIVE_NESTING=3

# ===========================================
# CONTAINER MEMORY LIMITS
# ===========================================

# Maximum memory for the entire container in megabytes
# This value is used in docker-compose.yml for mem_limit
# Container will be restarted when this limit is exceeded
# Recommended: 2GB for small systems, 4GB for medium, 8GB for large
MAX_MEMORY_MB=2048

# Request limit for automatic uvicorn worker restart
# Worker restarts after processing this number of requests
# This helps release accumulated memory from potential leaks
# 0 = no limit (NOT RECOMMENDED in production)
UVICORN_LIMIT_MAX_REQUESTS=1000

# ===========================================
# DoS PROTECTION SETTINGS
# ===========================================

# Enable/disable resource limits for child processes
ENABLE_RESOURCE_LIMITS=true

# Maximum memory consumption by child processes (in bytes)
# 1GB - base limit
MAX_SUBPROCESS_MEMORY=1073741824

# Maximum memory consumption for LibreOffice (in bytes)
# LibreOffice may consume more memory when converting complex documents
# 1.5GB
MAX_LIBREOFFICE_MEMORY=1610612736

# Maximum memory consumption for Tesseract (in bytes)
# Tesseract usually consumes less memory but may be demanding for large images
# 512MB
MAX_TESSERACT_MEMORY=536870912

# Maximum resolution for OCR images (in pixels)
# Images larger than this will be rejected
# 50MP (e.g., 7071x7071 or 10000x5243)
MAX_OCR_IMAGE_PIXELS=52428800

# ===========================================
# CONFIGURATION RECOMMENDATIONS
# ===========================================

# For small systems (2-4GB RAM):
# MAX_SUBPROCESS_MEMORY=536870912      # 512MB
# MAX_LIBREOFFICE_MEMORY=1073741824    # 1GB
# MAX_TESSERACT_MEMORY=268435456       # 256MB

# For medium systems (8-16GB RAM) - ACTIVE SETTINGS:
# 1GB
MAX_SUBPROCESS_MEMORY=1073741824
# 2GB
MAX_LIBREOFFICE_MEMORY=2147483648
# 512MB
MAX_TESSERACT_MEMORY=536870912

# For large systems (32GB+ RAM):
# MAX_SUBPROCESS_MEMORY=2147483648     # 2GB
# MAX_LIBREOFFICE_MEMORY=4294967296    # 4GB
# MAX_TESSERACT_MEMORY=1073741824      # 1GB

# To disable limits (NOT RECOMMENDED in production):
# ENABLE_RESOURCE_LIMITS=false

# Logging
LOG_LEVEL=INFO

# ===========================================
# WEB EXTRACTOR SETTINGS (v1.10.0)
# ===========================================

# Minimum image size for OCR in pixels (width * height)
# 150x150 = 22500 pixels
MIN_IMAGE_SIZE_FOR_OCR=22500

# Maximum number of images to process per web page
MAX_IMAGES_PER_PAGE=20

# Web page load timeout in seconds
WEB_PAGE_TIMEOUT=30

# Image download timeout in seconds
IMAGE_DOWNLOAD_TIMEOUT=15

# Default User-Agent for web requests
DEFAULT_USER_AGENT="Text Extraction Bot 1.0"

# Enable JavaScript execution (requires additional resources)
# false - static HTML only (default)
# true - JavaScript execution for dynamic content
ENABLE_JAVASCRIPT=false

# Blocked IP ranges for SSRF protection
# Blocked: localhost, private networks (10.*, 192.168.*, 172.16-31.*), IPv6 localhost, metadata service
BLOCKED_IP_RANGES="127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,169.254.0.0/16,::1/128,fe80::/10"

# Blocked hostnames (hostname-based blocking)
# Blocked: localhost, Docker hosts, IPv6 loopback names
BLOCKED_HOSTNAMES="localhost,host.docker.internal,ip6-localhost,ip6-loopback"

# ===========================================
# WEB EXTRACTOR SETTINGS v1.10.1 (PLAYWRIGHT)
# ===========================================

# Enable base64 image support in web pages
# true - process images in data:image/...;base64,... format (default)
# false - ignore base64 images
ENABLE_BASE64_IMAGES=true

# Delay after JavaScript load in seconds
# Wait time for JS rendering to complete after main page load
WEB_PAGE_DELAY=3

# Enable lazy loading image wait
# true - auto-scroll page to activate lazy loading (default)
# false - don't scroll page
ENABLE_LAZY_LOADING_WAIT=true

# Separate timeout for JS rendering in seconds
# Time to wait for network activity stabilization during JavaScript execution
JS_RENDER_TIMEOUT=10

# Maximum scroll attempts for lazy loading
# Protection against infinite pages
MAX_SCROLL_ATTEMPTS=3

# ===========================================
# PLAYWRIGHT CONFIGURATION RECOMMENDATIONS
# ===========================================

# For fast processing without JS (minimal resources):
# ENABLE_JAVASCRIPT=false
# ENABLE_BASE64_IMAGES=true
# ENABLE_LAZY_LOADING_WAIT=false

# For full processing with JavaScript (requires more resources):
ENABLE_JAVASCRIPT=true
ENABLE_BASE64_IMAGES=true
ENABLE_LAZY_LOADING_WAIT=true
WEB_PAGE_DELAY=5
JS_RENDER_TIMEOUT=15
MAX_SCROLL_ATTEMPTS=5

# For processing complex SPA applications:
# ENABLE_JAVASCRIPT=true
# WEB_PAGE_DELAY=10
# JS_RENDER_TIMEOUT=20